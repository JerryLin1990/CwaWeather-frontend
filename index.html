<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÈªûÈªûÂ§©Ê∞£</title>
    <link rel="icon" type="image/png" href="./pixel-icon.png">
    <link rel="apple-touch-icon" href="./pixel-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./pixel-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

    <style>
        :root {
            --game-body: #C0C0C0;
            /* Game Boy Classic (Á∂†Ëâ≤) - È†êË®≠ */
            --game-screen-bg: #9bbc0f;
            --game-screen-dark: #0f380f;
            --game-screen-light: #8bac0f;
            --game-screen-lightest: #9bbc0f;
        }

        /* Game Boy Pocket (ÁÅ∞Èöé) */
        body[data-theme="pocket"] {
            --game-screen-bg: #c4cfa1;
            --game-screen-dark: #43523d;
            --game-screen-light: #8b956d;
            --game-screen-lightest: #c4cfa1;
        }

        /* Game Boy Light (ÈáëËâ≤) */
        body[data-theme="light"] {
            --game-screen-bg: #f7e7c6;
            --game-screen-dark: #7c3f00;
            --game-screen-light: #d4a574;
            --game-screen-lightest: #f7e7c6;
        }

        /* Virtual Boy (Á¥ÖËâ≤) */
        body[data-theme="virtual"] {
            --game-screen-bg: #ff0000;
            --game-screen-dark: #550000;
            --game-screen-light: #aa0000;
            --game-screen-lightest: #ff0000;
        }

        /* Game Boy Color - ËóçËâ≤ */
        body[data-theme="color-blue"] {
            --game-screen-bg: #6bb6ff;
            --game-screen-dark: #003d7a;
            --game-screen-light: #2e8bc0;
            --game-screen-lightest: #6bb6ff;
        }

        /* Game Boy Color - Á¥´Ëâ≤ */
        body[data-theme="color-purple"] {
            --game-screen-bg: #d4a5ff;
            --game-screen-dark: #4a148c;
            --game-screen-light: #7b3fb2;
            --game-screen-lightest: #d4a5ff;
        }

        /* ÈªëÁôΩÁ∂ìÂÖ∏ */
        body[data-theme="mono"] {
            --game-screen-bg: #e0e0e0;
            --game-screen-dark: #1a1a1a;
            --game-screen-light: #6a6a6a;
            --game-screen-lightest: #e0e0e0;
        }

        /* Áê•ÁèÄËâ≤ CRT */
        body[data-theme="amber"] {
            --game-screen-bg: #ffb000;
            --game-screen-dark: #3d2800;
            --game-screen-light: #cc8800;
            --game-screen-lightest: #ffb000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'DotGothic16', sans-serif;
            background-color: #222;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            padding: 20px 0;
            transition: all 0.3s ease;
        }

        .game-console {
            background-color: var(--game-body);
            width: 360px;
            padding: 20px 20px 40px 20px;
            border-radius: 10px 10px 40px 10px;
            box-shadow:
                inset -5px -5px 10px rgba(0, 0, 0, 0.2),
                inset 5px 5px 10px rgba(255, 255, 255, 0.5),
                10px 10px 20px rgba(0, 0, 0, 0.5);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .screen-bezel {
            background-color: #555;
            width: 100%;
            padding: 30px 30px 10px 30px;
            border-radius: 10px 10px 30px 10px;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            position: relative;
        }

        .brand-text {
            color: #b0b0b0;
            font-size: 0.8rem;
            margin-bottom: 5px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .battery-light {
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            box-shadow: 0 0 5px #f00;
            animation: battery-pulse 2s ease-in-out infinite;
        }

        @keyframes battery-pulse {

            0%,
            100% {
                opacity: 0.6;
                box-shadow: 0 0 3px #f00;
            }

            50% {
                opacity: 1;
                box-shadow: 0 0 15px #f00, 0 0 5px #ff6666 inset;
            }
        }

        .lcd-screen {
            background-color: var(--game-screen-bg);
            width: 100%;
            height: 400px;
            border: 4px solid #444;
            box-shadow: inset 4px 4px 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
            color: var(--game-screen-dark);
            background-image:
                linear-gradient(transparent 95%, rgba(15, 56, 15, 0.1) 50%);
            background-size: 100% 4px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .content-wrapper {
            padding: 10px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--game-screen-dark);
            margin-bottom: 10px;
        }

        .location-pill {
            font-weight: 900;
            font-size: 0.95rem;
        }

        .update-pill {
            font-size: 0.7rem;
            background: var(--game-screen-dark);
            color: var(--game-screen-bg);
            padding: 2px 5px;
        }

        .hero-card {
            border: 2px solid var(--game-screen-dark);
            padding: 15px 8px 10px 8px;
            text-align: center;
            position: relative;
            background: rgba(15, 56, 15, 0.05);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hero-period {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--game-screen-bg);
            color: var(--game-screen-dark);
            padding: 0 10px;
            font-weight: bold;
            border: 2px solid var(--game-screen-dark);
        }

        .hero-temp-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .hero-icon {
            font-size: 3.2rem;
            filter: drop-shadow(2px 2px 0 var(--game-screen-dark));
            animation: bounce 3s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .hero-temp {
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
        }

        .hero-desc {
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px dashed var(--game-screen-dark);
        }

        .advice-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid var(--game-screen-dark);
            padding: 4px;
            background: var(--game-screen-bg);
        }

        .advice-icon {
            font-size: 1.3rem;
        }

        .advice-text {
            font-size: 0.9rem;
            font-weight: 900;
            margin: 2px 0;
        }

        .controls-area {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 20px;
        }

        .d-pad {
            width: 90px;
            height: 90px;
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        .d-pad div {
            background: #333;
            position: absolute;
            border-radius: 3px;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .d-pad.pressed div:not(.d-pad-center):not(.d-pad-button) {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        .d-pad-h {
            width: 100%;
            height: 30px;
            top: 30px;
            left: 0;
        }

        .d-pad-v {
            width: 30px;
            height: 100%;
            top: 0;
            left: 30px;
        }

        .d-pad-center {
            width: 30px;
            height: 30px;
            top: 30px;
            left: 30px;
            background: #2a2a2a !important;
            z-index: 2;
            box-shadow: none !important;
        }

        .d-pad-button {
            position: absolute;
            z-index: 15;
            cursor: pointer;
            background: transparent;
        }

        .d-pad-up {
            top: 0;
            left: 30px;
            width: 30px;
            height: 30px;
        }

        .d-pad-down {
            bottom: 0;
            left: 30px;
            width: 30px;
            height: 30px;
        }

        .d-pad-left {
            top: 30px;
            left: 0;
            width: 30px;
            height: 30px;
        }

        .d-pad-right {
            top: 30px;
            right: 0;
            width: 30px;
            height: 30px;
        }

        .action-btns {
            display: flex;
            gap: 15px;
            transform: rotate(-15deg);
        }

        .btn {
            width: 35px;
            height: 35px;
            background: #A00;
            border-radius: 50%;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
            position: relative;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .btn.pressed {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        .btn::after {
            content: '';
            position: absolute;
            bottom: -15px;
            right: 0;
            font-size: 0.8rem;
            font-weight: bold;
            color: #555;
        }

        .btn-a::after {
            content: 'A';
        }

        .btn-b::after {
            content: 'B';
        }

        .start-select {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .pill-btn {
            width: 40px;
            height: 12px;
            background: #999;
            border-radius: 10px;
            transform: rotate(-15deg);
            border: 1px solid #777;
        }

        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--game-screen-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            color: var(--game-screen-dark);
        }

        .loading-bar-container {
            width: 80%;
            height: 20px;
            border: 2px solid var(--game-screen-dark);
            padding: 2px;
            margin-top: 10px;
        }

        .loading-bar {
            height: 100%;
            background: var(--game-screen-dark);
            width: 0%;
            animation: loadProgress 1.5s steps(5) forwards;
        }

        @keyframes loadProgress {
            0% {
                width: 0%;
            }

            100% {
                width: 100%;
            }
        }

        .blink-text {
            animation: blink 0.5s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* ‰∏ªÈ°åÊåáÁ§∫Âô® */
        .theme-indicator {
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 0.6rem;
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <div class="game-console">
        <div class="screen-bezel">
            <div class="brand-text">
                <span>PORTABLE WEATHER SYSTEM</span>
                <div class="battery-light"></div>
            </div>

            <div class="lcd-screen">
                <div id="loading" class="loading-screen">
                    <div style="font-size: 1.5rem; font-weight: bold;">ÈªûÈªûÂ§©Ê∞£</div>
                    <div style="font-size: 0.8rem; margin-top:5px;">ËºâÂÖ•‰∏≠</div>
                    <div class="loading-bar-container">
                        <div class="loading-bar"></div>
                    </div>
                    <div class="blink-text" style="margin-top: 10px; font-size: 0.8rem;">Ë´ãÁ®çÂÄô...</div>
                </div>

                <div class="content-wrapper" id="mainContent" style="display: none;">
                    <div class="status-bar">
                        <div id="locationPill" class="location-pill">üìç ËºâÂÖ•‰∏≠...</div>
                        <div id="updateTime" class="update-pill">Êõ¥Êñ∞‰∏≠...</div>
                    </div>

                    <div id="heroCard"></div>

                    <div style="text-align: center; margin-top: 8px; font-size: 0.65rem; opacity: 0.6;">
                        ‚Üê‚Üí ÂàáÊèõÂüéÂ∏Ç | ‚Üë‚Üì ÂàáÊèõÊôÇÊÆµ | A/B ÊèõËâ≤
                    </div>

                    <div id="themeIndicator" class="theme-indicator">Á∂ìÂÖ∏Á∂†</div>
                </div>
            </div>
        </div>

        <div class="controls-area">
            <div class="d-pad">
                <div class="d-pad-h"></div>
                <div class="d-pad-v"></div>
                <div class="d-pad-center"></div>
                <div class="d-pad-button d-pad-up" data-direction="up"></div>
                <div class="d-pad-button d-pad-down" data-direction="down"></div>
                <div class="d-pad-button d-pad-left" data-direction="left"></div>
                <div class="d-pad-button d-pad-right" data-direction="right"></div>
            </div>
            <div class="action-btns">
                <div class="btn btn-b"></div>
                <div class="btn btn-a"></div>
            </div>
        </div>

        <div class="start-select">
            <div class="pill-btn"></div>
            <div class="pill-btn"></div>
        </div>
    </div>

    <script>
        const API_URL = "https://ntpc-weather.zeabur.app/api/weather/AllCounties";

        // Ëâ≤ÂΩ©‰∏ªÈ°åÈÖçÁΩÆ
        const themes = [
            { name: 'classic', label: 'Á∂ìÂÖ∏Á∂†', attr: null },
            { name: 'pocket', label: 'ÁÅ∞Èöé', attr: 'pocket' },
            { name: 'light', label: 'ÈáëËâ≤', attr: 'light' },
            { name: 'virtual', label: 'Á¥ÖËâ≤', attr: 'virtual' },
            { name: 'color-blue', label: 'ËóçËâ≤', attr: 'color-blue' },
            { name: 'color-purple', label: 'Á¥´Ëâ≤', attr: 'color-purple' },
            { name: 'mono', label: 'ÈªëÁôΩ', attr: 'mono' },
            { name: 'amber', label: 'Áê•ÁèÄ', attr: 'amber' }
        ];

        let currentThemeIndex = 0;

        function changeTheme(direction) {
            if (direction === 'next') {
                currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            } else {
                currentThemeIndex = (currentThemeIndex - 1 + themes.length) % themes.length;
            }

            const theme = themes[currentThemeIndex];

            if (theme.attr) {
                document.body.setAttribute('data-theme', theme.attr);
            } else {
                document.body.removeAttribute('data-theme');
            }

            document.getElementById('themeIndicator').textContent = theme.label;
            console.log('ÂàáÊèõ‰∏ªÈ°å:', theme.label);
        }

        function getWeatherIcon(weather) {
            if (!weather) return "üå§Ô∏è";
            if (weather.includes("Êô¥")) return "‚òÄÔ∏è";
            if (weather.includes("Â§öÈõ≤")) return "‚õÖ";
            if (weather.includes("Èô∞")) return "‚òÅÔ∏è";
            if (weather.includes("Èõ®")) return "üåßÔ∏è";
            if (weather.includes("Èõ∑")) return "‚õàÔ∏è";
            return "üå§Ô∏è";
        }

        function getAdvice(rainProb, maxTemp) {
            let rainIcon = "üåÇ";
            let rainText = "ÂÖçÂ∏∂ÂÇò Á©©";
            if (parseInt(rainProb) > 30) {
                rainIcon = "‚òÇÔ∏è";
                rainText = "Â∏∂ÂÇòÂï¶ Êøï";
            }

            let clothIcon = "üëï";
            let clothText = "ËàíÈÅ© ÊáÇÁ©ø";
            if (parseInt(maxTemp) >= 28) {
                clothIcon = "üéΩ";
                clothText = "ÁÜ±Èº† Áü≠Ë¢ñ";
            } else if (parseInt(maxTemp) <= 20) {
                clothIcon = "üß•";
                clothText = "ÂÜ∑Âñî Â§ñÂ•ó";
            }

            return { rainIcon, rainText, clothIcon, clothText };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "Êó©Êô®";
            if (hour >= 11 && hour < 14) return "‰∏≠Âçà";
            if (hour >= 14 && hour < 18) return "‰∏ãÂçà";
            if (hour >= 18 && hour < 23) return "Êôö‰∏ä";
            return "Ê∑±Â§ú";
        }

        let currentForecastIndex = 0;
        let currentCityIndex = 0;
        let allCities = [];
        let userCity = null;

        const cityMapping = {
            'Âè∞ÂåóÂ∏Ç': 'Ëá∫ÂåóÂ∏Ç',
            'Ëá∫ÂåóÂ∏Ç': 'Ëá∫ÂåóÂ∏Ç',
            'Êñ∞ÂåóÂ∏Ç': 'Êñ∞ÂåóÂ∏Ç',
            'Ê°ÉÂúíÂ∏Ç': 'Ê°ÉÂúíÂ∏Ç',
            'Âè∞‰∏≠Â∏Ç': 'Ëá∫‰∏≠Â∏Ç',
            'Ëá∫‰∏≠Â∏Ç': 'Ëá∫‰∏≠Â∏Ç',
            'Âè∞ÂçóÂ∏Ç': 'Ëá∫ÂçóÂ∏Ç',
            'Ëá∫ÂçóÂ∏Ç': 'Ëá∫ÂçóÂ∏Ç',
            'È´òÈõÑÂ∏Ç': 'È´òÈõÑÂ∏Ç',
            'Âü∫ÈöÜÂ∏Ç': 'Âü∫ÈöÜÂ∏Ç',
            'Êñ∞Á´πÂ∏Ç': 'Êñ∞Á´πÂ∏Ç',
            'ÂòâÁæ©Â∏Ç': 'ÂòâÁæ©Â∏Ç',
            'Êñ∞Á´πÁ∏£': 'Êñ∞Á´πÁ∏£',
            'ËãóÊ†óÁ∏£': 'ËãóÊ†óÁ∏£',
            'ÂΩ∞ÂåñÁ∏£': 'ÂΩ∞ÂåñÁ∏£',
            'ÂçóÊäïÁ∏£': 'ÂçóÊäïÁ∏£',
            'Èõ≤ÊûóÁ∏£': 'Èõ≤ÊûóÁ∏£',
            'ÂòâÁæ©Á∏£': 'ÂòâÁæ©Á∏£',
            'Â±èÊù±Á∏£': 'Â±èÊù±Á∏£',
            'ÂÆúËò≠Á∏£': 'ÂÆúËò≠Á∏£',
            'Ëä±ËìÆÁ∏£': 'Ëä±ËìÆÁ∏£',
            'Âè∞Êù±Á∏£': 'Ëá∫Êù±Á∏£',
            'Ëá∫Êù±Á∏£': 'Ëá∫Êù±Á∏£',
            'ÊæéÊπñÁ∏£': 'ÊæéÊπñÁ∏£',
            'ÈáëÈñÄÁ∏£': 'ÈáëÈñÄÁ∏£',
            'ÈÄ£Ê±üÁ∏£': 'ÈÄ£Ê±üÁ∏£'
        };

        function renderWeather(data) {
            allCities = data;
            currentCityIndex = 0;
            currentForecastIndex = 0;

            if (userCity) {
                const cityIndex = allCities.findIndex(city => city.city === userCity);
                if (cityIndex !== -1) {
                    currentCityIndex = cityIndex;
                    console.log('Â∑≤ÂàáÊèõÂà∞Áî®Êà∂ÂüéÂ∏Ç:', userCity);
                }
            }

            renderCurrentForecast();
        }

        function renderCurrentForecast() {
            if (allCities.length === 0) return;

            const currentCity = allCities[currentCityIndex];
            const allForecasts = currentCity.forecasts;

            if (allForecasts.length === 0) return;

            const current = allForecasts[currentForecastIndex];
            const totalCount = allForecasts.length;

            const advice = getAdvice(current.rain, current.maxTemp);
            const period = getTimePeriod(current.startTime);
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

            const currentDate = new Date(current.startTime);
            const today = new Date();
            const isToday = currentDate.getDate() === today.getDate();
            const dayLabel = isToday ? "‰ªäÂ§©" : "ÊòéÂ§©";

            document.getElementById('heroCard').innerHTML = `
                <div class="hero-card">
                    <div class="hero-period">${dayLabel} ${period}</div>
                    <div class="hero-temp-container">
                        <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                        <div class="hero-temp">${avgTemp}¬∞</div>
                    </div>
                    <div class="hero-desc">${current.weather}</div>
                    
                    <div class="advice-grid">
                        <div class="advice-item">
                            <div class="advice-icon">${advice.rainIcon}</div>
                            <div class="advice-text">${advice.rainText}</div>
                            <div style="font-size:0.65rem;">ÈôçÈõ®Áéá ${current.rain}</div>
                        </div>
                        <div class="advice-item">
                            <div class="advice-icon">${advice.clothIcon}</div>
                            <div class="advice-text">${advice.clothText}</div>
                            <div style="font-size:0.65rem;">ÊúÄÈ´òÊ∫´ ${current.maxTemp}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 0.65rem; opacity: 0.7;">
                        ÊôÇÊÆµ ${currentForecastIndex + 1}/${totalCount}
                    </div>
                </div>
            `;

            document.getElementById('locationPill').textContent = `üìç ${currentCity.city} (${currentCityIndex + 1}/${allCities.length})`;

            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayIndex = now.getDay();
            const days = ["ÈÄ±Êó•", "ÈÄ±‰∏Ä", "ÈÄ±‰∫å", "ÈÄ±‰∏â", "ÈÄ±Âõõ", "ÈÄ±‰∫î", "ÈÄ±ÂÖ≠"];
            document.getElementById('updateTime').textContent = `${month}/${date} ${days[dayIndex]}`;
        }

        async function detectUserCity() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    console.log('ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Âú∞ÁêÜ‰ΩçÁΩÆ');
                    resolve(null);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const { latitude, longitude } = position.coords;
                            const response = await fetch(
                                `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&accept-language=zh-TW`
                            );
                            const data = await response.json();

                            const city = data.address.city || data.address.county || data.address.state;
                            console.log('ÂÅµÊ∏¨Âà∞ÁöÑÂüéÂ∏Ç:', city);

                            const mappedCity = cityMapping[city] || city;
                            resolve(mappedCity);
                        } catch (error) {
                            console.error('ÂèçÂêëÂú∞ÁêÜÁ∑®Á¢ºÈåØË™§:', error);
                            resolve(null);
                        }
                    },
                    (error) => {
                        console.log('ÁÑ°Ê≥ïÁç≤ÂèñÂú∞ÁêÜ‰ΩçÁΩÆ:', error.message);
                        resolve(null);
                    },
                    {
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            });
        }

        async function fetchWeather() {
            try {
                const delayPromise = new Promise(resolve => setTimeout(resolve, 2000));
                const fetchPromise = fetch(API_URL).then(res => res.json());
                const cityPromise = detectUserCity();

                const [_, json, detectedCity] = await Promise.all([delayPromise, fetchPromise, cityPromise]);

                userCity = detectedCity;
                console.log('Áî®Êà∂ÂüéÂ∏ÇË®≠ÂÆöÁÇ∫:', userCity);

                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else {
                    throw new Error("API Error");
                }
            } catch (e) {
                console.error(e);
                alert("ÈÄ£Á∑öÈåØË™§ÔºÅË´ãÊ™¢Êü•Á∂≤Ë∑Ø„ÄÇ");
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);

        const dPad = document.querySelector('.d-pad');
        const btnA = document.querySelector('.btn-a');
        const btnB = document.querySelector('.btn-b');

        function addPressEffect(element) {
            element.addEventListener('mousedown', () => {
                element.classList.add('pressed');
            });
            element.addEventListener('mouseup', () => {
                element.classList.remove('pressed');
            });
            element.addEventListener('mouseleave', () => {
                element.classList.remove('pressed');
            });
        }

        // D-pad ÊñπÂêëÊåâÈàïÈªûÊìä‰∫ã‰ª∂
        document.querySelectorAll('.d-pad-button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation();
                const direction = button.dataset.direction;

                dPad.classList.add('pressed');
                setTimeout(() => {
                    dPad.classList.remove('pressed');
                }, 150);

                switch (direction) {
                    case 'up':
                        if (allCities.length > 0 && allCities[currentCityIndex].forecasts.length > 0) {
                            const totalForecasts = allCities[currentCityIndex].forecasts.length;
                            currentForecastIndex = (currentForecastIndex - 1 + totalForecasts) % totalForecasts;
                            renderCurrentForecast();
                        }
                        break;
                    case 'down':
                        if (allCities.length > 0 && allCities[currentCityIndex].forecasts.length > 0) {
                            const totalForecasts = allCities[currentCityIndex].forecasts.length;
                            currentForecastIndex = (currentForecastIndex + 1) % totalForecasts;
                            renderCurrentForecast();
                        }
                        break;
                    case 'left':
                        if (allCities.length > 0) {
                            currentCityIndex = (currentCityIndex - 1 + allCities.length) % allCities.length;
                            currentForecastIndex = 0;
                            renderCurrentForecast();
                        }
                        break;
                    case 'right':
                        if (allCities.length > 0) {
                            currentCityIndex = (currentCityIndex + 1) % allCities.length;
                            currentForecastIndex = 0;
                            renderCurrentForecast();
                        }
                        break;
                }
            });
        });

        // A/B ÊåâÈàïÈªûÊìä‰∫ã‰ª∂ - ÂàáÊèõ‰∏ªÈ°å
        btnA.addEventListener('click', () => {
            changeTheme('next');
        });

        btnB.addEventListener('click', () => {
            changeTheme('prev');
        });

        addPressEffect(btnA);
        addPressEffect(btnB);

        const keyHandlers = {
            'ArrowUp': () => {
                dPad.classList.add('pressed');
                if (allCities.length > 0 && allCities[currentCityIndex].forecasts.length > 0) {
                    const totalForecasts = allCities[currentCityIndex].forecasts.length;
                    currentForecastIndex = (currentForecastIndex - 1 + totalForecasts) % totalForecasts;
                    renderCurrentForecast();
                }
            },
            'ArrowDown': () => {
                dPad.classList.add('pressed');
                if (allCities.length > 0 && allCities[currentCityIndex].forecasts.length > 0) {
                    const totalForecasts = allCities[currentCityIndex].forecasts.length;
                    currentForecastIndex = (currentForecastIndex + 1) % totalForecasts;
                    renderCurrentForecast();
                }
            },
            'ArrowLeft': () => {
                dPad.classList.add('pressed');
                if (allCities.length > 0) {
                    currentCityIndex = (currentCityIndex - 1 + allCities.length) % allCities.length;
                    currentForecastIndex = 0;
                    renderCurrentForecast();
                }
            },
            'ArrowRight': () => {
                dPad.classList.add('pressed');
                if (allCities.length > 0) {
                    currentCityIndex = (currentCityIndex + 1) % allCities.length;
                    currentForecastIndex = 0;
                    renderCurrentForecast();
                }
            },
            'a': () => {
                btnA.classList.add('pressed');
                changeTheme('next');
            },
            'A': () => {
                btnA.classList.add('pressed');
                changeTheme('next');
            },
            'z': () => {
                btnB.classList.add('pressed');
                changeTheme('prev');
            },
            'Z': () => {
                btnB.classList.add('pressed');
                changeTheme('prev');
            }
        };

        document.addEventListener('keydown', (e) => {
            const handler = keyHandlers[e.key];
            if (handler) {
                const element = e.key.startsWith('Arrow') ? dPad :
                    (e.key === 'a' || e.key === 'A') ? btnA : btnB;
                if (!element.classList.contains('pressed')) {
                    handler();
                    e.preventDefault();
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key.startsWith('Arrow')) {
                dPad.classList.remove('pressed');
                e.preventDefault();
            } else if (e.key === 'a' || e.key === 'A') {
                btnA.classList.remove('pressed');
                e.preventDefault();
            } else if (e.key === 'z' || e.key === 'Z') {
                btnB.classList.remove('pressed');
                e.preventDefault();
            }
        });
    </script>
</body>

</html>